public class ShopifyConnection {
    
    //public static ShopifyAPI__c authentication = ShopifyAPI__c.getOrgDefaults();

    public static String[] getShopifyEntity(String instance, String entity, String filters){
        ShopifyAPI_List__c authentication = ShopifyAPI_List__c.getValues(instance);
        String headerLink = null;
        Blob headerValue = Blob.valueOf(authentication.API_Key__c + ':' + authentication.Password__c);
        String authorizationHeader = 'Basic ' + EncodingUtil.base64Encode(headerValue);
        HttpRequest request = new HttpRequest();
        request.setEndpoint(authentication.Base_URL__c + authentication.Version__c + '/' + entity + (String.isNotBlank(filters) ? '?' + filters : ''));
		//System.debug(endpoint);
        request.setHeader('Accept','application/json');
        request.setHeader('Content-type', 'application/json');
        request.setHeader('Authorization', authorizationHeader);
        request.setMethod('GET');
        request.setTimeout(120000);
        Http http = new Http();
        HTTPResponse response;
        try{
            if(!Test.isRunningTest()){
                response = http.send(request);
                System.debug(response.getHeader('Link'));
                headerLink = response.getHeader('Link');
                System.debug('->ShopifyConnection= ' + authentication.Base_URL__c + ', version = ' +  authentication.Version__c + ', entity = ' +  entity + ', filters = ' +  filters + ') => Response Status Code: ' + response.getStatusCode() + ', Response Body: ' + (String.isNotEmpty(response.getBody()) ? response.getBody().left(255) : ''));
            }else{
                response = new HTTPResponse();
                response.setStatusCode(200);
                if(entity.equalsIgnoreCase('customers')) response.setBody('{"customers": [{"id": 3193424052359,"email": "slr17301@aol.com","accepts_marketing": true,"created_at": "2020-04-08T15:10:27-07:00","updated_at": "2020-04-08T15:10:27-07:00","first_name": null,"last_name": null,"orders_count": 0,"state": "disabled","total_spent": "0.00","last_order_id": null,"note": null,"verified_email": true,"multipass_identifier": null,"tax_exempt": false,"phone": null,"tags": "newsletter","last_order_name": null,"currency": "USD","addresses": [],"accepts_marketing_updated_at": "2020-04-08T15:10:27-07:00","marketing_opt_in_level": "single_opt_in","admin_graphql_api_id": "gid://shopify/Customer/3193424052359"},{"id": 3193222856839,"email": "ssanton@verizon.net","accepts_marketing": true,"created_at": "2020-04-08T14:45:41-07:00","updated_at": "2020-04-13T09:35:42-07:00","first_name": "Shauna","last_name": "Anton","orders_count": 1,"state": "disabled","total_spent": "67.50","last_order_id": 2134748725383,"note": null,"verified_email": true,"multipass_identifier": null,"tax_exempt": false,"phone": null,"tags": "","last_order_name": "#1310","currency": "USD","addresses": [{"id": 3322168639623,"customer_id": 3193222856839,"first_name": "Shauna","last_name": "Anton","company": "","address1": "42330 Wyandotte Street","address2": "","city": "Temecula","province": "California","country": "United States","zip": "92592","phone": "760 801 4808","name": "Shauna Anton","province_code": "CA","country_code": "US","country_name": "United States","default": true}],"accepts_marketing_updated_at": "2020-04-13T09:35:42-07:00","marketing_opt_in_level": "single_opt_in","admin_graphql_api_id":"gid://shopify/Customer/3193222856839","default_address": {"id": 3322168639623,"customer_id": 3193222856839,"first_name": "Shauna","last_name": "Anton","company": "","address1": "42330 Wyandotte Street","address2": "","city": "Temecula","province": "California","country": "United States","zip": "92592","phone": "760 801 4808","name": "Shauna Anton","province_code": "CA","country_code": "US","country_name": "United States","default": true}}]}');
                else if(entity.equalsIgnoreCase('products')) response.setBody('{"products": [{"id": 4625235312775,"title": "BioFit 360 Gift Set","body_html": "","vendor": "BioFit 360","product_type": "Bundle","created_at": "2020-02-17T15:57:15-08:00","handle": "gift-set","updated_at": "2020-04-13T16:42:57-07:00","published_at": "2020-02-17T16:58:06-08:00","template_suffix": "details","published_scope": "global","tags": "Gummies, Tincture, Topicals","admin_graphql_api_id": "gid://shopify/Product/4625235247239","variants": [{"id": 32660152320135,"product_id": 4625235247239,"title": "Default Title","price": "150.00","sku": "SF-UNITTEST-2","position": 1,"inventory_policy": "deny","compare_at_price": "166.00","fulfillment_service": "manual","inventory_management": null,"option1": "Default Title","option2": null,"option3": null,"created_at": "2020-02-17T15:57:16-08:00","updated_at": "2020-04-06T16:58:28-07:00","taxable": true,"barcode": "","grams": 227,"image_id": null,"weight": 0.5,"weight_unit": "lb","inventory_item_id": 34303050612871,"inventory_quantity": 0,"old_inventory_quantity": 0,"requires_shipping": true,"admin_graphql_api_id": "gid://shopify/ProductVariant/32660152320135"}],"options":[{"id": 5972776484999,"product_id": 4625235247239,"name": "Title","position": 1,"values": ["Default Title"]}],"images": [{"id": 14704883695751,"product_id": 4625235247239,"position": 1,"created_at": "2020-02-17T15:57:38-08:00","updated_at": "2020-03-19T07:25:38-07:00","alt": "BioFit 360 Gift Set - BioFit 360","width": 720,"height": 720,"src":"https://cdn.shopify.com/s/files/1/0327/6904/8711/products/bag-with-three.png?v=1584627938","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704883695751"},{"id": 14704885858439,"product_id": 4625235247239,"position": 2,"created_at": "2020-02-17T15:57:43-08:00","updated_at": "2020-03-19T07:25:38-07:00","alt": "BioFit 360 Gift Set - BioFit 360","width": 1167,"height": 1167,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/6-2_de1b6a60-eac4-4e5c-b863-bd36dd6d1eeb.jpg?v=1584627938","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704885858439"},{"id": 14704884744327,"product_id": 4625235247239,"position": 3,"created_at": "2020-02-17T15:57:40-08:00","updated_at": "2020-03-19T07:25:38-07:00","alt": "BioFit 360 Gift Set - BioFit 360","width": 1191,"height": 1191,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/14.jpg?v=1584627938","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704884744327"},{"id": 14704885301383,"product_id": 4625235247239,"position": 4,"created_at": "2020-02-17T15:57:42-08:00","updated_at": "2020-03-19T07:25:38-07:00","alt": "BioFit 360 Gift Set - BioFit 360","width": 1171,"height": 1171,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/19.jpg?v=1584627938","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704885301383"}],"image": {"id": 14704883695751,"product_id": 4625235247239,"position": 1,"created_at": "2020-02-17T15:57:38-08:00","updated_at": "2020-03-19T07:25:38-07:00","alt": "BioFit 360 Gift Set - BioFit 360","width": 720,"height": 720,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/bag-with-three.png?v=1584627938","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704883695751"}},{"id": 4625234821255,"title": "BioFit Sample Pak","body_html": "","vendor": "BioFit 360","product_type": "Bundle","created_at": "2020-02-17T15:57:11-08:00","handle": "biofit-hemp-oil-sample-pak","updated_at": "2020-04-13T16:42:57-07:00","published_at": "2020-02-19T12:30:47-08:00","template_suffix": "","published_scope": "global","tags": "CBD Oil, gummies, Self Care, tincture, topicals","admin_graphql_api_id": "gid://shopify/Product/4625234854023","variants": [{"id": 32660151795847,"product_id": 4625234854023,"title": "Default Title","price": "43.00","sku": "SF-UNITTEST-","position": 1,"inventory_policy": "deny","compare_at_price": null,"fulfillment_service": "manual","inventory_management": null,"option1": "Default Title","option2": null,"option3": null,"created_at": "2020-02-17T15:57:11-08:00","updated_at": "2020-04-06T16:43:47-07:00","taxable": true,"barcode": "","grams": 312,"image_id": null,"weight": 11,"weight_unit": "oz","inventory_item_id": 34303049793671,"inventory_quantity": 0,"old_inventory_quantity": 0,"requires_shipping": true,"admin_graphql_api_id": "gid://shopify/ProductVariant/32660151795847"}],"options": [{"id": 5972776026247,"product_id": 4625234854023,"name": "Title","position": 1,"values": ["Default Title"]}],"images": [{"id": 14704877305991,"product_id": 4625234854023,"position": 1,"created_at": "2020-02-17T15:57:22-08:00","updated_at": "2020-03-19T07:25:39-07:00","alt": "BioFit Sample Pak - BioFit 360","width": 2122,"height": 2560,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/biofit-box.png?v=1584627939","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704877305991"},{"id": 14704877797511,"product_id": 4625234854023,"position": 2,"created_at": "2020-02-17T15:57:24-08:00","updated_at": "2020-03-19T07:25:39-07:00","alt": "BioFit Sample Pak - BioFit 360","width": 1701,"height": 1701,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/box3.jpg?v=1584627939","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704877797511"},{"id": 14704878649479,"product_id": 4625234854023,"position": 3,"created_at": "2020-02-17T15:57:26-08:00","updated_at": "2020-03-19T07:25:39-07:00","alt": "BioFit Sample Pak - BioFit 360","width": 1676,"height": 1676,"src": "https://cdn.shopify.com/s/files/1/0327/6904/8711/products/box5.jpg?v=1584627939","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704878649479"}],"image": {"id": 14704877305991,"product_id": 4625234854023,"position": 1,"created_at": "2020-02-17T15:57:22-08:00","updated_at": "2020-03-19T07:25:39-07:00","alt": "BioFit Sample Pak - BioFit 360","width":2122,"height":2560,"src":"https://cdn.shopify.com/s/files/1/0327/6904/8711/products/biofit-box.png?v=1584627939","variant_ids": [],"admin_graphql_api_id": "gid://shopify/ProductImage/14704877305991"}}]}');
                else if(entity.contains('orders')) response.setBody('{ "orders": [ { "id": 450789469, "email": "bob.norman@hostmail.com", "closed_at": null, "created_at": "2008-01-10T11:00:00-05:00", "updated_at": "2008-01-10T11:00:00-05:00", "number": 1, "note": null, "token": "b1946ac92492d2347c6235b4d2611184", "gateway": "authorize_net", "test": false, "total_price": "598.94", "subtotal_price": "597.00", "total_weight": 0, "total_tax": "11.94", "taxes_included": false, "currency": "USD", "financial_status": "partially_refunded", "confirmed": true, "total_discounts": "10.00", "total_line_items_price": "597.00", "cart_token": "68778783ad298f1c80c3bafcddeea02f", "buyer_accepts_marketing": false, "name": "#1001", "referring_site": "http://www.otherexample.com", "landing_site": "http://www.example.com?source=abc", "cancelled_at": null, "cancel_reason": null, "total_price_usd": "598.94", "checkout_token": "bd5a8aa1ecd019dd3520ff791ee3a24c", "reference": "fhwdgads", "user_id": null, "location_id": null, "source_identifier": "fhwdgads", "source_url": null, "processed_at": "2008-01-10T11:00:00-05:00", "device_id": null, "phone": "+557734881234", "customer_locale": null, "app_id": null, "browser_ip": "0.0.0.0", "landing_site_ref": "abc", "order_number": 1001, "discount_applications": [ { "type": "discount_code", "value": "10.0", "value_type": "fixed_amount", "allocation_method": "across", "target_selection": "all", "target_type": "line_item", "code": "TENOFF" } ], "discount_codes": [ { "code": "TENOFF", "amount": "10.00", "type": "fixed_amount" } ], "note_attributes": [ { "name": "custom engraving", "value": "Happy Birthday" }, { "name": "colour", "value": "green" } ], "payment_gateway_names": [ "bogus" ], "processing_method": "direct", "checkout_id": 901414060, "source_name": "web", "fulfillment_status": null, "tax_lines": [ { "price": "11.94", "rate": 0.06, "title": "State Tax", "price_set": { "shop_money": { "amount": "11.94", "currency_code": "USD" }, "presentment_money": { "amount": "11.94", "currency_code": "USD" } } } ], "tags": "", "contact_email": "bob.norman@hostmail.com", "order_status_url": "https://apple.myshopify.com/690933842/orders/b1946ac92492d2347c6235b4d2611184/authenticate?key=8e236d9b93673aaf22b4db6ae8263000", "presentment_currency": "USD", "total_line_items_price_set": { "shop_money": { "amount": "597.00", "currency_code": "USD" }, "presentment_money": { "amount": "597.00", "currency_code": "USD" } }, "total_discounts_set": { "shop_money": { "amount": "10.00", "currency_code": "USD" }, "presentment_money": { "amount": "10.00", "currency_code": "USD" } }, "total_shipping_price_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "subtotal_price_set": { "shop_money": { "amount": "597.00", "currency_code": "USD" }, "presentment_money": { "amount": "597.00", "currency_code": "USD" } }, "total_price_set": { "shop_money": { "amount": "598.94", "currency_code": "USD" }, "presentment_money": { "amount": "598.94", "currency_code": "USD" } }, "total_tax_set": { "shop_money": { "amount": "11.94", "currency_code": "USD" }, "presentment_money": { "amount": "11.94", "currency_code": "USD" } }, "total_tip_received": "0.0", "original_total_duties_set": null, "current_total_duties_set": null, "admin_graphql_api_id": "gid://shopify/Order/450789469", "shipping_lines": [ { "id": 369256396, "title": "Free Shipping", "price": "0.00", "code": "Free Shipping", "source": "shopify", "phone": null, "requested_fulfillment_service_id": null, "delivery_category": null, "carrier_identifier": null, "discounted_price": "0.00", "price_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discounted_price_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [], "tax_lines": [] } ], "billing_address": { "first_name": "Bob", "address1": "Chestnut Street 92", "phone": "555-625-1199", "city": "Louisville", "zip": "40202", "province": "Kentucky", "country": "United States", "last_name": "Norman", "address2": "", "company": null, "latitude": 45.41634, "longitude": -75.6868, "name": "Bob Norman", "country_code": "US", "province_code": "KY" }, "shipping_address": { "first_name": "Bob", "address1": "Chestnut Street 92", "phone": "555-625-1199", "city": "Louisville", "zip": "40202", "province": "Kentucky", "country": "United States", "last_name": "Norman", "address2": "", "company": null, "latitude": 45.41634, "longitude": -75.6868, "name": "Bob Norman", "country_code": "US", "province_code": "KY" }, "client_details": { "browser_ip": "0.0.0.0", "accept_language": null, "user_agent": null, "session_hash": null, "browser_width": null, "browser_height": null }, "payment_details": { "credit_card_bin": null, "avs_result_code": null, "cvv_result_code": null, "credit_card_number": "•••• •••• •••• 4242", "credit_card_company": "Visa" }, "customer": { "id": 3095641129095, "email": "bob.norman@hostmail.com", "accepts_marketing": false, "created_at": "2020-04-06T10:51:36-04:00", "updated_at": "2020-04-06T10:51:36-04:00", "first_name": "Bob", "last_name": "Norman", "orders_count": 1, "state": "disabled", "total_spent": "199.65", "last_order_id": 450789469, "note": null, "verified_email": true, "multipass_identifier": null, "tax_exempt": false, "phone": null, "tags": "", "last_order_name": "#1001", "currency": "USD", "accepts_marketing_updated_at": "2005-06-12T11:57:11-04:00", "marketing_opt_in_level": null, "tax_exemptions": [], "admin_graphql_api_id": "gid://shopify/Customer/207119551", "default_address": { "id": 207119551, "customer_id": 207119551, "first_name": null, "last_name": null, "company": null, "address1": "Chestnut Street 92", "address2": "", "city": "Louisville", "province": "Kentucky", "country": "United States", "zip": "40202", "phone": "555-625-1199", "name": "", "province_code": "KY", "country_code": "US", "country_name": "United States", "default": true } }, "line_items": [ { "id": 466157049, "variant_id": 39072856, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008GREEN", "variant_title": "green", "vendor": null, "fulfillment_service": "manual", "product_id": 4625235312775, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - green", "variant_inventory_management": "shopify", "properties": [ { "name": "Custom Engraving Front", "value": "Happy Birthday" }, { "name": "Custom Engraving Back", "value": "Merry Christmas" } ], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.34", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.34", "currency_code": "USD" }, "presentment_money": { "amount": "3.34", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/466157049", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] }, { "id": 518995019, "variant_id": 49148385, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008RED", "variant_title": "red", "vendor": null, "fulfillment_service": "manual", "product_id": 632910392, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - red", "variant_inventory_management": "shopify", "properties": [], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.33", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.33", "currency_code": "USD" }, "presentment_money": { "amount": "3.33", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/518995019", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] }, { "id": 703073504, "variant_id": 457924702, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008BLACK", "variant_title": "black", "vendor": null, "fulfillment_service": "manual", "product_id": 632910392, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - black", "variant_inventory_management": "shopify", "properties": [], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.33", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.33", "currency_code": "USD" }, "presentment_money": { "amount": "3.33", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/703073504", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] } ], "fulfillments": [ { "id": 255858046, "order_id": 450789469, "status": "failure", "created_at": "2020-04-06T10:51:36-04:00", "service": "manual", "updated_at": "2020-04-06T10:51:36-04:00", "tracking_company": "USPS", "shipment_status": null, "location_id": 905684977, "tracking_number": "1Z2345", "tracking_numbers": [ "1Z2345" ], "tracking_url": "https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=1Z2345", "tracking_urls": [ "https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=1Z2345" ], "receipt": { "testcase": true, "authorization": "123456" }, "name": "#1001.0", "admin_graphql_api_id": "gid://shopify/Fulfillment/255858046", "refund_line_items  ": [ { "id": 466157049, "variant_id": 39072856, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008GREEN", "variant_title": "green", "vendor": null, "fulfillment_service": "manual", "product_id": 632910392, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - green", "variant_inventory_management": "shopify", "properties": [ { "name": "Custom Engraving Front", "value": "Happy Birthday" }, { "name": "Custom Engraving Back", "value": "Merry Christmas" } ], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.34", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.34", "currency_code": "USD" }, "presentment_money": { "amount": "3.34", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/466157049", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] } ] } ], "refunds": [ { "id": 509562969, "order_id": 450789469, "created_at": "2020-04-06T10:51:36-04:00", "note": "it broke during shipping", "user_id": 799407056, "processed_at": "2020-04-06T10:51:36-04:00", "restock": true, "duties": [], "admin_graphql_api_id": "gid://shopify/Refund/509562969", "refund_line_items": [ { "id": 104689539, "quantity": 1, "line_item_id": 703073504, "location_id": 487838322, "restock_type": "legacy_restock", "subtotal": 195.67, "total_tax": 3.98, "subtotal_set": { "shop_money": { "amount": "195.67", "currency_code": "USD" }, "presentment_money": { "amount": "195.67", "currency_code": "USD" } }, "total_tax_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } }, "line_item": { "id": 703073504, "variant_id": 457924702, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008BLACK", "variant_title": "black", "vendor": null, "fulfillment_service": "manual", "product_id": 632910392, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - black", "variant_inventory_management": "shopify", "properties": [], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.33", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.33", "currency_code": "USD" }, "presentment_money": { "amount": "3.33", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/703073504", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] } }, { "id": 709875399, "quantity": 1, "line_item_id": 466157049, "location_id": 487838322, "restock_type": "legacy_restock", "subtotal": 195.66, "total_tax": 3.98, "subtotal_set": { "shop_money": { "amount": "195.66", "currency_code": "USD" }, "presentment_money": { "amount": "195.66", "currency_code": "USD" } }, "total_tax_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } }, "line_item": { "id": 466157049, "variant_id": 39072856, "title": "IPod Nano - 8gb", "quantity": 1, "sku": "IPOD2008GREEN", "variant_title": "green", "vendor": null, "fulfillment_service": "manual", "product_id": 632910392, "requires_shipping": true, "taxable": true, "gift_card": false, "name": "IPod Nano - 8gb - green", "variant_inventory_management": "shopify", "properties": [ { "name": "Custom Engraving Front", "value": "Happy Birthday" }, { "name": "Custom Engraving Back", "value": "Merry Christmas" } ], "product_exists": true, "fulfillable_quantity": 1, "grams": 200, "price": "199.00", "total_discount": "0.00", "fulfillment_status": null, "price_set": { "shop_money": { "amount": "199.00", "currency_code": "USD" }, "presentment_money": { "amount": "199.00", "currency_code": "USD" } }, "total_discount_set": { "shop_money": { "amount": "0.00", "currency_code": "USD" }, "presentment_money": { "amount": "0.00", "currency_code": "USD" } }, "discount_allocations": [ { "amount": "3.34", "discount_application_index": 0, "amount_set": { "shop_money": { "amount": "3.34", "currency_code": "USD" }, "presentment_money": { "amount": "3.34", "currency_code": "USD" } } } ], "duties": [], "admin_graphql_api_id": "gid://shopify/LineItem/466157049", "tax_lines": [ { "title": "State Tax", "price": "3.98", "rate": 0.06, "price_set": { "shop_money": { "amount": "3.98", "currency_code": "USD" }, "presentment_money": { "amount": "3.98", "currency_code": "USD" } } } ] } } ], "transactions": [ { "id": 179259969, "order_id": 450789469, "kind": "refund", "gateway": "bogus", "status": "success", "message": null, "created_at": "2005-08-05T12:59:12-04:00", "test": false, "authorization": "authorization-key", "location_id": null, "user_id": null, "parent_id": 801038806, "processed_at": "2005-08-05T12:59:12-04:00", "device_id": null, "receipt": {}, "error_code": null, "source_name": "web", "amount": "209.00", "currency": "USD", "admin_graphql_api_id": "gid://shopify/OrderTransaction/179259969" } ], "order_adjustments": [] } ] } ] }');
                //else if(entity.equalsIgnoreCase('orders')) response.setBody('{"orders":[{"id": 2174205100167,"email": "Mersinodrydn@aol.com","closed_at": "2020-04-20T08:15:57-07:00","created_at": "2020-04-20T06:53:03-07:00","updated_at": "2020-04-20T08:15:57-07:00","number": 321,"note": null,"token": "c522ad6f63a62142a30619d5425e77d3","gateway": "manual","test": false,"total_price": "118.00","subtotal_price": "118.00","total_weight": 198,"total_tax": "0.00","taxes_included": false,"currency": "USD","financial_status": "paid","confirmed": true,"total_discounts": "0.00","total_line_items_price": "118.00","cart_token": null,"buyer_accepts_marketing": true,"name": "#1321","referring_site": "","landing_site": null,"cancelled_at": null,"cancel_reason": null,"total_price_usd": "118.00","checkout_token": null,"reference": null,"user_id": null,"location_id": null,"source_identifier": null,"source_url": null,"processed_at": "2020-04-20T06:53:03-07:00","device_id": null,"phone": null,"customer_locale": null,"app_id": 3201505,"browser_ip": null,"landing_site_ref": null,"order_number": 1321,"discount_applications": [],"discount_codes": [],"note_attributes": [],"payment_gateway_names": ["manual"],"processing_method": "","checkout_id": null,"source_name": "3201505","fulfillment_status": "fulfilled","tax_lines": [],"tags": "paid","contact_email": "Mersinodrydn@aol.com","order_status_url": "https://www.biofit360.com/32769048711/orders/c522ad6f63a62142a30619d5425e77d3/authenticate?key=70b2f1dd94090287413e0278fb51a3e8","presentment_currency": "USD","total_line_items_price_set": {"shop_money": {"amount": "118.00","currency_code": "USD"},"presentment_money": {"amount": "118.00","currency_code": "USD"}},"total_discounts_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"total_shipping_price_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"subtotal_price_set": {"shop_money": {"amount": "118.00","currency_code": "USD"},"presentment_money": {"amount": "118.00","currency_code": "USD"}},"total_price_set": {"shop_money": {"amount": "118.00","currency_code": "USD"},"presentment_money": {"amount": "118.00","currency_code": "USD"}},"total_tax_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"line_items": [{"id": 4770329362567,"variant_id": 32853695201415,"title": "Vegan Hemp Oil Gummies - Gummies 30 ct.","quantity": 2,"sku": "BF-GUM30-0030","variant_title": "Gummies 30 ct.","vendor": "BioFit 360","fulfillment_service": "manual","product_id": 4625234821255,"requires_shipping": true,"taxable": true,"gift_card": false,"name": "Vegan Hemp Oil Gummies - Gummies 30 ct. - Gummies 30 ct.","variant_inventory_management": null,"properties": [],"product_exists": true,"fulfillable_quantity": 0,"grams": 99,"price": "59.00","total_discount": "0.00","fulfillment_status": "fulfilled","price_set": {"shop_money": {"amount": "59.00","currency_code": "USD"},"presentment_money": {"amount": "59.00","currency_code": "USD"}},"total_discount_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"discount_allocations": [],"admin_graphql_api_id": "gid://shopify/LineItem/4770329362567","tax_lines": []}],"fulfillments": [{"id": 1998749630599,"order_id": 2174205100167,"status": "success","created_at": "2020-04-20T08:15:57-07:00","service": "manual","updated_at": "2020-04-20T08:15:57-07:00","tracking_company": "USPS","shipment_status": null,"location_id": 39970537607,"line_items": [{"id": 4770329362567,"variant_id": 32853695201415,"title": "Vegan Hemp Oil Gummies - Gummies 30 ct.","quantity": 2,"sku": "BF-GUM30-0030","variant_title": "Gummies 30 ct.","vendor": "BioFit 360","fulfillment_service": "manual","product_id": 4625234821255,"requires_shipping": true,"taxable": true,"gift_card": false,"name": "Vegan Hemp Oil Gummies - Gummies 30 ct. - Gummies 30 ct.","variant_inventory_management": null,"properties": [],"product_exists": true,"fulfillable_quantity": 0,"grams": 99,"price": "59.00","total_discount": "0.00","fulfillment_status": "fulfilled","price_set": {"shop_money": {"amount": "59.00","currency_code": "USD"},"presentment_money": {"amount": "59.00","currency_code": "USD"}},"total_discount_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"discount_allocations": [],"admin_graphql_api_id": "gid://shopify/LineItem/4770329362567","tax_lines": []}],"tracking_number": "9400110202079102791001","tracking_numbers": ["9400110202079102791001"],"tracking_url": "https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=9400110202079102791001","tracking_urls": ["https://tools.usps.com/go/TrackConfirmAction_input?qtc_tLabels1=9400110202079102791001"],"receipt": {},"name": "#1321.1","admin_graphql_api_id": "gid://shopify/Fulfillment/1998749630599"}],"refunds": [],"total_tip_received": "0.0","admin_graphql_api_id":"gid://shopify/Order/2174205100167","shipping_lines": [{"id": 1740162302087,"title": "Free Shipping","price": "0.00","code": "Free Shipping","source": "shopify","phone": null,"requested_fulfillment_service_id": null,"delivery_category": null,"carrier_identifier": null,"discounted_price": "0.00","price_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"discounted_price_set": {"shop_money": {"amount": "0.00","currency_code": "USD"},"presentment_money": {"amount": "0.00","currency_code": "USD"}},"discount_allocations": [],"tax_lines": []}],"billing_address": {"first_name": "Jeffery","address1": "1172 Lone Pine Drive ","phone": "8107060467","city": "Fairview ","zip": "48621","province": "Michigan","country": "United States","last_name": "Mersino ","address2": "","company": "","latitude": 44.7156232,"longitude": -84.0817478,"name": "Jeffery Mersino ","country_code": "US","province_code": "MI"},"shipping_address": {"first_name": "Jeff","address1": "143 Cotillion Lane ","phone": "8107060467","city": "North Fort Myers ","zip": "33903","province": "Florida","country": "United States","last_name": " Mersino ","address2": null,"company": null,"latitude": 26.6936708,"longitude": -81.9027876,"name": "Jeff  Mersino ","country_code": "US","province_code": "FL"},"customer": {"id": 3095641358471,"email": "Mersinodrydn@aol.com","accepts_marketing": true,"created_at": "2020-03-17T15:52:02-07:00","updated_at": "2020-04-20T06:53:04-07:00","first_name": "Jeffery","last_name": "Mersino","orders_count": 2,"state": "disabled","total_spent": "182.00","last_order_id": 2174205100167,"note": null,"verified_email": true,"multipass_identifier": null,"tax_exempt": false,"phone": null,"tags": "","last_order_name": "#1321","currency": "USD","accepts_marketing_updated_at": "2020-04-20T06:53:04-07:00","marketing_opt_in_level":"single_opt_in","admin_graphql_api_id":"gid://shopify/Customer/3095641358471","default_address": {"id": 3383611687047,"customer_id": 3095641358471,"first_name": "Jeff ","last_name": "Mersino ","company": "","address1": "143 Cotillion Lane ","address2": "","city": "North Fort Myers ","province": "Florida","country": "United States","zip": "33903","phone": "8107060467","name": "Jeff  Mersino ","province_code": "FL","country_code": "US","country_name": "United States","default": true}}}]}');
          		else if(entity.contains('checkouts')) response.setBody('{ "checkouts": [ { "id": 12742290276487, "token": "a87d8d49847eb1ee745e9a073fa653fe", "cart_token": "54e9ea3fb025356fda956b96b2afa36b", "email": "neha@webinopoly.co", "gateway": null, "buyer_accepts_marketing": true, "created_at": "2020-04-29T11:32:54-07:00", "updated_at": "2020-04-29T21:35:01-07:00", "landing_site": "/", "note": null, "note_attributes": [], "referring_site": "", "shipping_lines": [], "taxes_included": false, "total_weight": 99, "currency": "USD", "completed_at": null, "closed_at": null, "user_id": null, "location_id": null, "source_identifier": null, "source_url": null, "device_id": null, "phone": null, "customer_locale": "en", "line_items": [ { "applied_discounts": [], "key": "8aba6301652b41ee2ecc36ae28168407", "destination_location_id": null, "fulfillment_service": "manual", "gift_card": false, "grams": 99, "origin_location_id": 1741409452167, "presentment_title": "Vegan Hemp Oil Gummies", "presentment_variant_title": "Gummies 30 ct.", "product_id": 4625234821255, "properties": [], "quantity": 1, "requires_shipping": true, "sku": "BF-GUM30-0030", "tax_lines": [], "taxable": true, "title": "Vegan Hemp Oil Gummies", "variant_id": 32853695201415, "variant_title": "Gummies 30 ct.", "variant_price": "59.00", "vendor": "BioFit 360", "user_id": null, "unit_price_measurement": { "measured_type": null, "quantity_value": null, "quantity_unit": null, "reference_value": null, "reference_unit": null }, "country_hs_codes": [], "country_code_of_origin": null, "province_code_of_origin": null, "harmonized_system_code": null, "compare_at_price": "94.00", "line_price": "59.00", "price": "59.00" } ], "name": "#12742290276487", "source": null, "abandoned_checkout_url": "https://www.biofit360.com/32769048711/checkouts/a87d8d49847eb1ee745e9a073fa653fe/recover?key=f9f8143853318e7232e4990acd81d60b", "discount_codes": [], "tax_lines": [], "source_name": "web", "presentment_currency": "USD", "total_discounts": "0.00", "total_line_items_price": "59.00", "total_price": "59.00", "total_tax": "0.00", "subtotal_price": "59.00" }, { "id": 12877738934407, "token": "01d137af7d9938e7e58c2e39c80a3c61", "cart_token": "fdc451d3d73bfa1ea1e97a891ebcc689", "email": "angellia650.8841@gmail.com", "gateway": null, "buyer_accepts_marketing": true, "created_at": "2020-05-16T22:49:52-07:00", "updated_at": "2020-05-16T23:55:01-07:00", "landing_site": "/", "note": null, "note_attributes": [], "referring_site": "", "shipping_lines": [ { "code": "Free Shipping", "price": "0.00", "markup": null, "original_shop_price": "0.0", "source": "shopify", "title": "Free Shipping", "presentment_title": "Free Shipping", "phone": null, "delivery_category": null, "carrier_identifier": null, "carrier_service_id": null, "api_client_id": null, "requested_fulfillment_service_id": null, "applied_discounts": [], "tax_lines": [], "custom_tax_lines": null, "validation_context": null, "id": "b0a44ff98695e7be02bef2204b4e2af7" } ], "taxes_included": false, "total_weight": 311, "currency": "USD", "completed_at": null, "closed_at": null, "user_id": null, "location_id": null, "source_identifier": null, "source_url": null, "device_id": null, "phone": null, "customer_locale": "en", "line_items": [ { "applied_discounts": [], "key": "0338c72c3a9425bc24bd370f680b03fb", "destination_location_id": null, "fulfillment_service": "manual", "gift_card": false, "grams": 312, "origin_location_id": 1741409452167, "presentment_title": "BioFit Sample Pak", "presentment_variant_title": "", "product_id": 4625234854023, "properties": [], "quantity": 1, "requires_shipping": true, "sku": "BF-SAMPK-0001", "tax_lines": [], "taxable": true, "title": "BioFit Sample Pak", "variant_id": 32660151795847, "variant_title": "", "variant_price": "43.00", "vendor": "BioFit 360", "user_id": null, "unit_price_measurement": { "measured_type": null, "quantity_value": null, "quantity_unit": null, "reference_value": null, "reference_unit": null }, "country_hs_codes": [], "country_code_of_origin": null, "province_code_of_origin": null, "harmonized_system_code": null, "compare_at_price": null, "line_price": "43.00", "price": "43.00" } ], "name": "#12877738934407", "source": null, "abandoned_checkout_url": "https://www.biofit360.com/32769048711/checkouts/01d137af7d9938e7e58c2e39c80a3c61/recover?key=62f8a1bdbf3651d7c5ede7ac04f54098", "discount_codes": [], "tax_lines": [], "source_name": "web", "presentment_currency": "USD", "total_discounts": "0.00", "total_line_items_price": "43.00", "total_price": "43.00", "total_tax": "0.00", "subtotal_price": "43.00", "shipping_address": { "first_name": "jack", "address1": "allen street 8", "phone": "2489874868", "city": "New York", "zip": "10004", "province": "New York", "country": "United States", "last_name": "black", "address2": "allen street 8", "company": null, "latitude": null, "longitude": null, "name": "jack black", "country_code": "US", "province_code": "NY" }, "customer": { "id": 3369055617159, "email": "angellia650.8841@gmail.com", "accepts_marketing": true, "created_at": "2020-05-16T22:50:08-07:00", "updated_at": "2020-05-16T22:50:08-07:00", "first_name": "jack", "last_name": "black", "orders_count": 0, "state": "disabled", "total_spent": "0.00", "last_order_id": null, "note": null, "verified_email": true, "multipass_identifier": null, "tax_exempt": false, "phone": null, "tags": "", "last_order_name": null, "currency": "USD", "accepts_marketing_updated_at": "2020-05-16T22:50:08-07:00", "marketing_opt_in_level": "single_opt_in", "admin_graphql_api_id": "gid://shopify/Customer/3369055617159", "default_address": { "id": 3513470189703, "customer_id": 3369055617159, "first_name": "jack", "last_name": "black", "company": null, "address1": "allen street 8", "address2": "allen street 8", "city": "New York", "province": "New York", "country": "United States", "zip": "10004", "phone": "2489874868", "name": "jack black", "province_code": "NY", "country_code": "US", "country_name": "United States", "default": true } } } ] }');
          	}
        }
        catch(Exception e){
            response = new HTTPResponse();
            response.setStatusCode(500);
            System.debug('-->ShopifyConnection= ' + authentication.Base_URL__c + ', version = ' +  authentication.Version__c + ', entity = ' +  entity + ') - Callout Exception: ' + e.getMessage());
        }
		return new String []{response.getBody(), getNextPage(headerLink)};
        //return response.getBody();
    }
                                                                    
 	public static String getShopifyID(String idS, String instance){
    	return idS.contains(instance) ? idS.substring(instance.length()+1, idS.length()) : ids;
    }
                                                                    
    public static String getNextPage(String link){
        String pageInfo = '';
        if(link!=null){
    		List<String> enlaces = new List<String>();
            enlaces = link.split(',');
            for(String e : enlaces){
                System.debug(e);
                if(e.contains('next'))
                    pageInfo = e.subStringBetween('?', '>');
            }
        }
        System.debug('-------------------------------');
        System.debug(pageInfo);	  
        return pageInfo;
    }
    
}
